---
- name: ğŸ› ï¸ Mantenimiento AutomÃ¡tico - Servidor Zabbix
  hosts: zabbix_servers
  gather_facts: yes
  become: yes

  tasks:
    - name: ğŸ“Š Verificar informaciÃ³n del sistema
      debug:
        msg: |
          DistribuciÃ³n: {{ ansible_distribution }}
          VersiÃ³n: {{ ansible_distribution_version }}
          Gestor de paquetes: {{ ansible_pkg_mgr }}

    - name: ğŸ“¦ ACTUALIZAR SISTEMA (excluyendo zabbix*)
      dnf:
        name: "*"
        state: latest
        exclude: "zabbix*"
      
    - name: ğŸ§¹ Limpiar cache
      shell: "dnf clean all"

    - name: ğŸ“Š Verificar espacio
      shell: df -h
      register: disk_space

    - name: ğŸ“‹ Mostrar espacio
      debug:
        var: disk_space.stdout

    - name: ğŸ” Verificar servicios Zabbix
      systemd:
        name: "{{ item }}"
        state: started
      with_items:
        - zabbix-server
        - zabbix-agent
        - httpd
        - mariadb
      ignore_errors: yes

    - name: âœ… FINALIZADO
      debug:
        msg: "âœ… Mantenimiento completado en {{ ansible_hostname }}"
